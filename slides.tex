\documentclass[12pt]{beamer}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[portuguese, onelanguage]{algorithm2e}
\usepackage{graphicx, tikz-qtree, caption, chronology}
\usepackage{hyperref}
\usepackage{subcaption}

\usetheme{CambridgeUS}
\usecolortheme{seagull}
\setbeamertemplate{title page}[default][shadow=false]
\setbeamertemplate{headline}{}
\setbeamertemplate{itemize items}[triangle]
\setbeamertemplate{footline}[frame number]{}
\setbeamertemplate{navigation symbols}{}

\title{Esquemas de assinatura digital \\ pós-quânticos baseados em AES}
\author{Gustavo Zambonin\and Marcello Klingelfus}
\institute{
  \includegraphics[scale=0.15]{img/ufsc}            \\ \vspace{-4mm}
  Universidade Federal de Santa Catarina        \\
  Departmento de Informática e Estatística      \\ 
  INE5424 -- Sistemas Operacionais II           \\ \vspace{2mm}
  \texttt{\{gustavo.zambonin,marcello.klingelfus\}@grad.ufsc.br}
}
\date{}

\newcommand{\concat}{\, \vert \vert \,}
\newcommand{\hh}{$\mathcal{H}$}
\newcommand{\hash}[2][]{f^{#1}(#2)}
\newcommand{\pad}{\vert \vert \, 0^*}
\newcommand{\binwds}[1]{\{0, 1\}^{#1}}

\begin{document}

\begin{frame}[plain,noframenumbering]
  \titlepage
\end{frame}

\begin{frame}
  \frametitle{Motivação}
  \begin{itemize}
    \setlength\itemsep{0.5em}
    \item Independente de teoria de números ou problemas algébricos
    \begin{itemize}
      \item Possivelmente ``seguro contra computadores quânticos''
    \end{itemize}
    \item Para um esquema de assinatura digital, qualquer função
        de resumo criptográfico pode ser utilizada
    \begin{itemize}
      \item Escolhida situacionalmente (hardware, software)
    \end{itemize}
    \item Funções de mão única são necessárias e suficientes para assinatura digital
      \cite{Rompel:1990:OFN:100216.100269, cryptoeprint:2005:328}
    \item Cifras de bloco podem ser utilizadas na construção de funções de mão única \cite[9.14]{Menezes:1996:HAC:548089}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Funções de resumo criptográfico}
  \begin{equation*}
    \mathcal{H}: \{0, 1\}^{*} \longrightarrow \{0, 1\}^{n}
  \end{equation*}

  \begin{figure}
    \begin{tikzpicture}
      \node at (-6.5, 0) {entrada $\longrightarrow$};
      \foreach \sgn in {+, -}
        \draw plot[domain=1:5] (-\x, {\sgn 1/20*(3+\x*\x)});
      \foreach \r in {1, 2.3333, ..., 5}
        \draw (-\r, 0) ellipse[x radius=(\r+.5)/20, y radius=1/20*(3+\r*\r)];
      \node at (0.25, 0) {$\longrightarrow$ resumo};
    \end{tikzpicture}
  \end{figure}

  \begin{itemize}
    \item SHA-2, SHA-3, BLAKE: $n \in \{224, 256, 384, 512\}$
    \item Keccak: qualquer $n$
    \item Resistência à pré-imagem, segunda pré-imagem, colisão
  \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{AES}
    \framesubtitle{Definições}
    \begin{itemize}
        \item Versão padronizada do algoritmo Rjindael \cite{Daemen:2002:DR:560131}
        \begin{itemize}
            \item Principais escolhas de design: inversibilidade e eficiência
        \end{itemize}
        \item Cifra de blocos iterativa parametrizada por uma chave $K$
        \begin{itemize}
            \item Conceito de rede de substituição-permutação (\href{https://www.iacr.org/authors/tikz/tikz/Construction/spn.pdf}{SPN})
            \item $\vert K \vert \in \{128, 192, 256\}$
            \item 10, 12 ou 14 rodadas ($n_r$), respectivamente
        \end{itemize}
        \item Opera sobre uma matriz de estado $A$
        \begin{itemize}
            \item $A_{i,j} \in \mathbb{F}_{2^8}, 0 \leq i, j \leq 3$
            \item Deslocamentos de linhas e permutas de elementos
            \item Operações sobre bytes análogas a cálculos em $\mathbb{F}_{2^8}$
        \end{itemize}
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{AES}
    \framesubtitle{Etapa \emph{SubBytes}}
    \begin{columns}[T]
        \begin{column}{.7\textwidth}
          \begin{itemize}
            \item Única etapa não-linear,
          \end{itemize}
        \end{column}
        \begin{column}{.25\textwidth}
            \begin{figure}
            \centering
            \begin{subfigure}[b]{0.7\textwidth}
               \includegraphics{img/sub_bytes_fwd.pdf}
               \vspace{2mm}
            \end{subfigure}
            
            \begin{subfigure}[b]{0.7\textwidth}
               \includegraphics{img/sub_bytes_inv.pdf}
            \end{subfigure}
                    \captionsetup{font=scriptsize}
        
            \caption*{Pictogramas para as etapas \emph{SubBytes} (acima) e sua inversa \emph{InvSubBytes}.}
            \end{figure}
        \end{column}
    \end{columns}
\end{frame}

\begin{frame}
    \frametitle{AES}
    \framesubtitle{Etapa \emph{ShiftRows}}
    \begin{columns}[T]
        \begin{column}{.7\textwidth}
          \begin{itemize}
            \item Assinaturas únicas em cada folha, árvore construída a partir de chaves públicas
            \item Estado da arte dos esquemas baseados em funções de resumo criptográfico
            \item XMSS, XMSS$^{MT}$, SPHINCS
          \end{itemize}
        \end{column}
        \begin{column}{.25\textwidth}
            \begin{figure}
            \centering
            \begin{subfigure}[b]{0.7\textwidth}
               \includegraphics{img/shift_rows_fwd.pdf}
               \vspace{2mm}
            \end{subfigure}
            
            \begin{subfigure}[b]{0.7\textwidth}
               \includegraphics{img/shift_rows_inv.pdf}
            \end{subfigure}
                    \captionsetup{font=scriptsize}
        
            \caption*{Pictogramas para as etapas \emph{ShiftRows} (acima) e sua inversa \emph{InvShiftRows}.}
            \end{figure}
        \end{column}
    \end{columns}
\end{frame}

\begin{frame}
    \frametitle{AES}
    \framesubtitle{Etapa \emph{MixColumns}}
    \begin{columns}[T]
        \begin{column}{.7\textwidth}
          \begin{itemize}
            \item Assinaturas únicas em cada folha, árvore construída a partir de chaves públicas
            \item Estado da arte dos esquemas baseados em funções de resumo criptográfico
            \item XMSS, XMSS$^{MT}$, SPHINCS
          \end{itemize}
        \end{column}
        \begin{column}{.25\textwidth}
            \begin{figure}
            \centering
            \begin{subfigure}[b]{0.7\textwidth}
               \includegraphics{img/mix_columns_fwd.pdf}
               \vspace{2mm}
            \end{subfigure}
            
            \begin{subfigure}[b]{0.7\textwidth}
               \includegraphics{img/mix_columns_inv.pdf}
            \end{subfigure}
                    \captionsetup{font=scriptsize}
        
            \caption*{Pictogramas para as etapas \emph{MixColumns} (acima) e sua inversa \emph{InvMixColumns}.}
            \end{figure}
        \end{column}
    \end{columns}
\end{frame}

\begin{frame}
    \frametitle{AES}
    \framesubtitle{Etapa \emph{AddRoundKey}}
    \begin{columns}[T]
        \begin{column}{.7\textwidth}
          \begin{itemize}
            \item Assinaturas únicas em cada folha, árvore construída a partir de chaves públicas
            \item Estado da arte dos esquemas baseados em funções de resumo criptográfico
            \item XMSS, XMSS$^{MT}$, SPHINCS
          \end{itemize}
        \end{column}
        \begin{column}{.25\textwidth}
            \begin{figure}
            \centering
            \begin{subfigure}[b]{0.7\textwidth}
               \includegraphics{img/add_round_key.pdf}
               \vspace{2mm}
            \end{subfigure}
                    \captionsetup{font=scriptsize}
        
            \caption*{Pictograma para a etapa \emph{AddRoundKey}.}
            \end{figure}
        \end{column}
    \end{columns}
\end{frame}

\begin{frame}
    \frametitle{AES}
    \framesubtitle{Rotina \emph{KeyExpansion}}
\end{frame}

\begin{frame}
    \frametitle{AES}
    \framesubtitle{Representação gráfica da codificação e decodificação para $n_r = 2$}
    
    \begin{figure}
        \centering
        \includegraphics{img/aes_two_rounds.pdf}
        \label{fig:my_label}
    \end{figure}
\end{frame}

\begin{frame}
  \frametitle{Assinatura digital}
  \begin{itemize}
    \item Provê autenticação, integridade e não-repúdio
    \item Baseado em criptografia de chaves públicas
    \item Tripla de algoritmos probabilísticos de tempo polinomial
      \cite{Goldreich:2004:FCV:975541}
    \begin{itemize}
      \item Geração de chaves (\emph{Gen}), geração da assinatura (\emph{Sig}),\\
          verificação da assinatura (\emph{Ver})
    \end{itemize}
  \end{itemize}

    \begin{figure}[h]
      \centering
      \begin{tikzpicture}
        \node (hm) at (-1.25, 0) {$m$};
        \node (in) at (0, -2) {$1^n$};
        \node (sk) at (0, -1) {$\mathcal{S}_k$};
        \node (pk) at (4, -1) {$\mathcal{P}_k$};
        \node (ds) at (2, 0)
          {\scriptsize{$m \concat Sig(\mathcal{S}_k, \mathcal{H}(m))$}};
        \node (res) at (5.5, 0) {\scriptsize\{0, 1\}};
        \node[draw] (sig) at (0, 0) {\emph{Sig}};
        \node[draw] (gen) at (2, -2) {\emph{Gen}};
        \node[draw] (ver) at (4, 0) {\emph{Ver}};
        \draw[-latex] (gen) to (1.25, -1) to (sk);
        \draw[-latex] (gen) to (2.75, -1) to (pk);
        \draw[-latex] (sk) -- (sig);
        \draw[-latex] (hm) -- (sig);
        \draw[-latex] (sig) -- (ds);
        \draw[-latex] (ds) -- (ver);
        \draw[-latex] (pk) -- (ver);
        \draw[-latex] (ver) -- (res);
        \draw[-latex] (in) -- (gen);
      \end{tikzpicture}
    \end{figure}
\end{frame}

\begin{frame}
  \frametitle{Esquemas de assinatura única}
  \begin{itemize}
    \item Par de chaves só deve ser utilizado uma única vez
    \item Lamport-Diffie (LD-OTS)
    \begin{itemize}
      \item Primeiro esquema baseado em resumos
      \item Mensagens de tamanho arbitrário podem ser assinadas, um bit por vez
    \end{itemize}
    \item Winternitz (WOTS)
    \begin{itemize}
      \item Múltiplos bits podem ser assinados simultaneamente
      \item Generalização do LD-OTS
      \item Compensação entre desempenho e tamanho da assinatura
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Winternitz OTS}
  \framesubtitle{Geração de chave}
  Seja $w \in \mathbb{N}, w > 1$ o parâmetro Winternitz,
  $f : \{0, 1\}^{n} \longrightarrow \{0, 1\}^{n}$
  e $\mathcal{H} : \{0, 1\}^{*} \longrightarrow \{0, 1\}^{n}$. Então,
   \begin{align*}
       t_1 &= \left\lceil \frac{n}{w} \right\rceil, t_2 = \left\lceil
       \frac{\lfloor log_2 t_1 \rfloor + 1 + w}{w} \right\rceil \text{ e } t = t_1 + t_2.
   \end{align*}
   As chaves privada e pública são, respectivamente,
   \begin{align*}
      \mathcal{S}_k &= (y_{t - 1}, \dots, y_{0})
        \stackrel{\$}{\longleftarrow} \{0,1\}^n \text{ e}\\
      \mathcal{P}_k &= (\hash[2^w - 1]{y_{t - 1}}, \dots, \hash[2^w - 1]{y_0}).
   \end{align*}
\end{frame}

\begin{frame}
  \frametitle{Winternitz OTS}
  \framesubtitle{Assinatura}
  Os valores $\epsilon_i \in \{0, 1\}^w$ são obtidos através de:
  
  \begin{minipage}{.45\linewidth}
  \begin{align*}
    \mathcal{H}(m) &= (\epsilon_{t - 1}, \dots, \epsilon_{t - t_1})
  \end{align*}
  \end{minipage}
  \begin{minipage}{.45\linewidth}
  \begin{align*}
    c &= \sum_{i = t - t_1}^{t - 1} (2^w - 1 - \epsilon_i) \\
      &= (\epsilon_{t_2 - 1}, \dots, \epsilon_{0})
  \end{align*}
  \end{minipage}
  \vspace{4mm}
  
  Finalmente, a assinatura de uso único é construída:
  \begin{align*}
    \sigma &= (f^{\epsilon_{t - 1}}(y_{t - 1}), \dots, f^{\epsilon_0}(y_0))
  \end{align*}
\end{frame}

\begin{frame}
  \frametitle{Winternitz OTS}
  \framesubtitle{Verificação}
  Relembrando,
  \begin{align*}
    \mathcal{P}_k &= (\hash[2^w - 1]{y_{t - 1}}, \dots, \hash[2^w - 1]{y_0}) \text{ e} \\
    \sigma &= (f^{\epsilon_{t - 1}}(y_{t - 1}), \dots, f^{\epsilon_0}(y_0)).
  \end{align*}
  Os elementos $\epsilon_i$ são calculados e utilizados na verificação de $\sigma$:
  \begin{align*}
    \forall \sigma_i \in \sigma, \hash[2^w - 1 - \epsilon_{i}]{\sigma_i} &= \mathcal{P}_{k_i}
  \end{align*}
\end{frame}

\begin{frame}
  \frametitle{Winternitz OTS}
  \framesubtitle{Variante WOTS+}
  \begin{itemize}
    \item Menores tamanhos de assinatura
    \item Elimina a necessidade de \hh{} resistente a colisões
    \begin{itemize}
      \item $\mathcal{F}_k : \{f_k : \binwds{n} \longrightarrow \binwds{n} \mid k \in \mathcal{K}_n\}$
      \item Operações adicionais usando $f_k$ ao invés de iterações simples
    \end{itemize}
    \item Máscaras de bit aleatórias em cada iteração
    \begin{align*}
      (b_0, \dots, b_{2^w - 1}) &\stackrel{\$}{\longleftarrow} \{0, 1\}^{n} \\
      c^0(x) &= x \\
      c^i(x) &= f_k(c^{i-1}(x) \oplus b_i)
    \end{align*}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Winternitz OTS}
  \framesubtitle{Utilizando $f$ como AES}
  \begin{itemize}
      \item Função $f$ derivada de uma cifra de bloco
      \item Construção Matyas-Meyer-Oseas \cite[9.41]{Menezes:1996:HAC:548089}
      \begin{itemize}
        \item Entrada $x$, saída $h_k$, cifra $E_K$ com bloco de $n$ bits e chave $K$
        \item Tome um valor inicial $IV$, $\vert IV \vert = n$, e uma função $g$ que gere chaves válidas para $E$
        \item $X = (x_0, \dots, x_{k - 1}), \forall x_i \in X, \vert x_i \vert = n$
        \item $h_0 = IV, h_i = E_{g(h_{i-1})}(x_i) \oplus x_i, 1 \leq i \leq k$
      \end{itemize}
      \item Assim, AES pode ser integrado ao WOTS+
      \begin{itemize}
        \item Multicolisões em WOTS simples, redução da segurança
      \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Esquemas baseados em árvores de Merkle}
  \begin{columns}[T]
    \begin{column}{.4\textwidth}
      \begin{itemize}
        \item Assinaturas únicas em cada folha, árvore construída a partir de chaves públicas
        \item Estado da arte dos esquemas baseados em funções de resumo criptográfico
        \item XMSS, XMSS$^{MT}$, SPHINCS
      \end{itemize}
    \end{column}
    \begin{column}{.4\textwidth}
      \begin{figure}
        \begin{tikzpicture}
          \tikzset{every tree node/.style={align=center,anchor=north,font=\tiny}}
          \Tree
            [.\node{$T_{r}$ \\ $\hash{T_{0} \concat T_{1}}$};
              [.\node{$T_{0}$ \\ $\mathcal{H}(T_{0, 0} \concat T_{0, 1})$};
                [.{$T_{0, 0}$ \\ $\mathcal{H}(\mathcal{D}_{0})$}
                  \edge[dashed, style={<-}] node {}; $\mathcal{D}_{0}$
                ]
                [.{$T_{0, 1}$ \\ $\mathcal{H}(\mathcal{D}_{1})$}
                  \edge[dashed, style={<-}] node {}; $\mathcal{D}_{1}$
                ]
              ]
              [.\node{$T_{1}$ \\ $\mathcal{H}(T_{1, 0} \concat T_{1, 1})$};
                [.{$T_{1, 0}$ \\ $\mathcal{H}(\mathcal{D}_{2})$}
                  \edge[dashed, style={<-}] node {}; $\mathcal{D}_{2}$
                ]
                [.{$T_{1, 1}$ \\ $\mathcal{H}(\mathcal{D}_{3})$}
                  \edge[dashed, style={<-}] node {}; $\mathcal{D}_{3}$
                ]
              ]
            ]
        \end{tikzpicture}
        \captionsetup{font=scriptsize}
        \caption*{Seja $\mathcal{D}_n$ um dado qualquer. Uma árvore de Merkle é construída recursivamente através da concatenação dos resumos dos filhos de um nó.}
      \end{figure}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}[allowframebreaks]
  \frametitle{Bibliografia}
  \bibliographystyle{plain}
  \bibliography{report}
\end{frame}

\end{document}
